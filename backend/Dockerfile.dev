# Development Dockerfile with hot reload
FROM eclipse-temurin:21-jdk-alpine

WORKDIR /app

# Install curl for health checks
RUN apk add --no-cache curl

# Create non-root user
RUN addgroup -g 1001 -S docmgr && \
    adduser -S docmgr -u 1001 -G docmgr

# Create directories
RUN mkdir -p /app/uploads /app/temp && \
    chown -R docmgr:docmgr /app

# Copy gradle wrapper
COPY gradle gradle
COPY gradlew build.gradle settings.gradle ./

# Make gradlew executable
RUN chmod +x gradlew

# Download dependencies for faster builds
RUN ./gradlew dependencies --no-daemon

# Copy source code
COPY src src

# Switch to non-root user
USER docmgr

EXPOSE 3000

# Use bootRun for development with hot reload
CMD ["./gradlew", "bootRun", "--no-daemon"]